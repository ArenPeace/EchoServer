# 分布式理论专题


## CAP 分布式理论
## Paxos

## 为什么使用zk和kafka
zk和kafka这种就是前面的1，后面可以加0。
但是从0到1是很难的。

## 消息队列

## Nosql

## 传统数据库
分库分表？

## 容器化
### Dokcer
### k8s

## Service Mesh

## 全链路
### ELK

## 分布式ID生成算法
uuid 128太长，zk性能不满足，snowflake需要多研究
### uuid算法
(略)
### snowflake算法
#### 举例
[39bit毫秒数][4bit业务线id][2bit机房id][7bit机器id][5bit预留][7bit毫秒内序号]  
每台服务器绝对递增，全局看只是趋势递增  
必然按msg-id/order-id/worker-id分库分表，取模运算要求ID生成具有“取模随机性",所以毫秒内序列号放最后，保证ID随机  
跨毫秒时，序号总是归0，序号尾为0的比较多，生成的ID取模不均匀，所以不是每次归零，而是归到0-9的随机数。

#### snowflake算法
[1bit不用][41bit时间戳][10bit机器ID][12bit序列号]  
第一比特保留  
时间戳，41比特，从2016年11月1日零点到现在的毫秒数,可以用到2156年，100多年后才会用完  
机器id，10比特，这个机器id每个业务要唯一，机器id获取的策略后面会详述  
序列号，12比特，每台机器每毫秒最多产生4096个id，超过这个数的话会等到下一毫秒  

## 负载均衡算法
web服务器集群，数据库服务器集群，分布式缓存服务集群等集群之前总有负载均衡服务。
云计算/分布式架构，本质也是把后端服务作为计算和存储资源封装到统一入口对外服务。
广泛使用的负载均衡软件：
LVS（linux virtual server)
nginx
haproxy

+ 轮询法，按顺序轮流分配到后端，均衡，不关系后端的存量连接数和系统负载
+ 随机法，按后端列表随机选取，效果接近轮询
+ 源地址哈希，同一IP客户端，总是映射到同一后端
+ 目标地址哈希？
+ 加权轮询，根据后端机器性能和负载，权重不同
+ 加权随机
+ 最小连接数，向最小连接后端分流

## 代理机制
agent/proxy/broker/delegate
主动代理/透传代理/中介代理/委托代理