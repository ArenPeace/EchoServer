# 领域驱动设计 Domain Drive Design
MVC（Modle - View - Controller）架构里，业务逻辑写在C中会重复、混乱，业务逻辑大都跨M处理，写不到M中，所以要多一层S（Service，MVCS），这是当前主流架构。
M（领域对象）不仅承载数据，也承载一些行为，称作充血模型；仅承载数据和一些getter/setter方法，称为贫血模型。
贫血模型的S层会退化为面向功能的开发活动，耦合多，内聚少；充血模型可以把业务逻辑封装在领域模型里，但封装的层次很难维护，批量类业务逻辑也不好实现。
主流架构一般把业务逻辑封装在Service层，M层承载数据结构。
哲学里，一般把操作的主体和客体分类，世界由客体（实体）组成，主体（观察者）感知或假定客体作为实体存在。正确的面向对象，应该把主体做“拟人化”，对客体做“拟物化”。主体感知也是改造客体的过程。领域模型是客体，领域服务是主体，应用程序的本质是认知世界


领域驱动是用于设计的，而不是用于需求分析。
项目管理中使用领域驱动设计？

## 域驱动的目标
将项目的主要重点放在核心领域和领域逻辑上；
根据领域模型建立复杂的设计；
启动技术专家和领域专家之间的创造性合作，以迭代方式完善解决特定领域问题的概念模型。

## 概念 Concepts
### 上下文 （语境？情景）context
用来确定其含义的单词或陈述的设置；
（当一个词语或语句新出现时）用于确定一个词语或语句的一系列设定（前置条件）。
### 域 domain
影响、活动（本体是一个知识领域）。软件上的领域是用户使用程序所在的主题区域（程序用于做什么？）。
### 模型 model
用于描述domain的某些方面的一系列抽象，用于解决与domain相关的问题。
### 通用语言 ubiquitous
一种围绕领域模型构建的语言，所有团队成员都使用该语言将团队的所有活动与软件联系起来。

## 领域驱动的设计策略 Strategic Design
理想情况下，最好有一个统一的模型。尽管这是一个崇高的目标，但实际上，它通常分为多个模型。生活中，认识到这个事实并实践是很有用的。
设计策略是维护模型完整性、提取域模型、使用多个模型的一组原则。

### 有界的上下文 Bouned Context
大型项目大都使用多种模型。但是，当将基于不同模型的代码组合在一起时，软件将变得漏洞百出、不可靠且难以理解。团队成员之间的沟通变得混乱、令人迷惑。通常不清楚一个模型不该应用在哪些情景中，模型乱象现象。

因此：显式地定义模型适用的情景。显式地给团队组织、应用程序特定部分的用法、代码库、数据库等物理存在设置边界。在这边界内，保持模型严格一致，而不是因内部和外部的问题而分神或困惑。

### 持续集成 Continuous Integration
一定数量的人群在相同的有界上下文中工作时，模型非常容易分裂（分叉？歧义）成多个。团队越大，问题就越大，但是只有三到四个人会遇到严重的问题。然而，系统分解为太小的情景，集成和一致性的价值也越小。

因此：建设频繁合并所有代码等其他人造品的流程，并使用自动测试来快速标记碎片。随着概念在人们的脑海中不断发展，请不懈地运用共同语言来敲定模型的共享视角。

### 上下文图 Context Map （全局视图）
在没有全局视图的情况下，单个有界上下文会带来一些问题。其他模型的上下文可能仍然含糊不清且不断变化。
其他团队的人员不会非常了解上下文范围，并且会在不知不觉中进行更改，从而模糊边缘或使交互复杂化。当必须在不同情景之间建立联系时，它们往往会相互渗入。

因此：确定项目中正在使用的每个模型并定义其有界的上下文。这包括非面向对象子系统的隐式模型。为每个有界上下文命名，并把该名称作为通用语言的一部分。描述模型之间的联系点，概述任何通信的显式翻译并强调任何共享。绘制现有地形。

## 建材 Building Blocks
在 “领域驱动的设计” 一书中，阐述了许多高级概念和实践，例如共同语言，这意味着领域模型应形成领域专家给出的用于描述系统需求的通用语言，并且同样有效适用于业务用户或赞助商以及软件开发人员。这本书非常着重于将域层描述为多层体系结构的面向对象系统中的常见层之一。
DDD中用于表达、创建和检索域模型的人造品：

### 实体 Entity
一个不由其属性定义的对象，而是由一贯的连续性及其身份标识定义的对象。
示例：大多数航空公司在每个航班上都唯一地区分每个座位。在这种情况下，每个席位都是一个实体。但是，西南航空，EasyJet和Ryanair并不区分每个座位。所有座位都一样。在这种情况下，席位实际上是价值对象。
### 价值对象 Value Object
包含属性但没有概念标识的对象。他们应该被视为一成不变的。
示例：人们交换名片时，通常不会区分每张唯一的名片；他们只关心卡上打印的信息。在这种情况下，名片是价值对象。
### 聚合 Aggregate
由根实体（也称为聚合根）绑定在一起的对象的集合。聚合根通过禁止外部对象保留对其成员的引用来确保聚合中所做更改的一致性。
例如：驾驶汽车时，您不必担心车轮向前移动、发动机里点火和烧油等。您只是在开车。在这种情况下，汽车是其他几个对象的集合，并充当所有其他系统的集合根。
### 域事件 Domain Event
定义事件（发生的事情）的域对象。域事件是域专家关心的事件。
### 服务 Service
当一个操作在概念上不属于任何对象时。遵循问题的自然轮廓，可以在服务中实施这些操作。另请参见服务（系统架构）。
### 仓库 Reposiory
**检索域对象的方法**应委派给专门的存储库对象，以便可以轻松交换备用存储实现。
### 厂 Factory
**用于创建域对象的方法**应委托给专门的Factory对象，以便可以轻松互换替代实现。

## 命令查询分析 Command-Query Separation / CQRS（职责分离）

## 缺点
为了帮助将模型保持为纯净而有用的语言构造，团队通常必须在域模型内实现大量的隔离和封装。因此，基于域驱动设计的系统的成本可能相对较高。虽然域驱动的设计提供了许多技术优势（例如可维护性），但是Microsoft建议仅将其应用于复杂领域，模型和语言处理在复杂信息交流、领域共识的构建方面具有明显优势。